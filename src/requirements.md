<h1 align="center">ДЕКОМПОЗИЦИЯ</h1>

  Для расчета метрик и построения ветрины ``dm_rfm_segments`` будет использоваться таблица ``orders`` и ее данные:``order_id``,  ``order_ts``, ``user_id``, ``cost``. Витрина будет строиться на заказах со статусом *Closed* с начала 2021 года. </br>
  для метрики *recency* используется ``orders.user_id`` и ``orders.order_ts``; </br>
  для метрики *frequency* используется ``orders.user_id`` и ``orders.order_id``; </br>
  для метрики *monetary_value* используется ``orders.user_id`` и ``orders.cost`` </br>

Формирование витрины для RFM-анализа:

1. Опишем исходные данные, их тип, ограничение и занесем информацию в *data_quality.md*;
2. Создадим представления в схеме *analysis*;
3. Создадим файл *dm_rfm_segments.sql*, в котором находится запрос на создание таблицы(ветрины) с необходимыми свойствами;
4. Создадим таблицы ``tmp_rfm_recency``, ``tmp_rfm_frequency``, ``tmp_rfm_monetary_value`` в которых будут находиться необходимые для ветрины метрики;
5. Напишим SQL-запросы для рассчета метрик *recency*, *frequency*, *monetary_value* и заполнения соответствующих им таблиц;
6. Создадим файл *datamart_query.sql*, который будет содержать SQL-запрос для формирования ветрины из подготовленных данных.

Доработка представлений:

1. Напишем SQL-код, который обновит представление и добавит поле status для построения ветрины
